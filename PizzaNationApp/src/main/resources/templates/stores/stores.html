<main>
    <div id="map" style="width:100%;height:500px"></div>
</main>

<th:block sec:authorize="isAnonymous() or hasAnyRole('ROLE_MODERATOR', 'ROLE_USER')">
    <script th:inline="javascript">
        function initMap() {
            var destination;
            /*<![CDATA[*/
            destination = /*[[${model}]]*/ null;
            /*]]>*/

            var myCenter = new google.maps.LatLng(destination.x, destination.y);
            var mapCanvas = document.getElementById("map");
            var mapOptions = {center: myCenter, zoom: 10};
            var map = new google.maps.Map(mapCanvas, mapOptions);
            var marker = new google.maps.Marker({position: myCenter});
            marker.setMap(map);
        }
    </script>
</th:block>
<th:block sec:authorize="hasRole('ROLE_ADMIN')">
    <script th:inline="javascript">
        function initMap() {
            var destination;
            /*<![CDATA[*/
            destination = /*[[${model}]]*/ null;
            /*]]>*/

            var myCenter = new google.maps.LatLng(destination.x, destination.y);
            var mapCanvas = document.getElementById("map");
            var mapOptions = {center: myCenter, zoom: 10};
            var map = new google.maps.Map(mapCanvas, mapOptions);
            var marker = new google.maps.Marker({position: myCenter});
            marker.setMap(map);

            addPopUpListener(marker, map);

            addClickListener(map);
        }

        function placeMarker(location, map) {
            var userMarker = new google.maps.Marker({
                position: location,
                map: map
            });

            addPopUpListener(userMarker, map);
        }

        function addPopUpListener(marker, map) {
            google.maps.event.addListener(marker, 'dblclick', function () {
                    var coordinates = {"lat": marker.getPosition().lat(), "lng": marker.getPosition().lng()};
                    console.log(coordinates);
                    var infowindow = new google.maps.InfoWindow({
                        content:
                        //onclick="saveMarker(\'' + coordinates + '\');"
                        '<button id="saveBtn"  onclick="saveMarker(\'' + coordinates + '\')">Add</button>' +
                        '<button id="editBtn" onclick="editMarker(\'' + coordinates + '\')">Edit</button>' +
                        '<button id="deleteBtn" onclick="deleteMarker(\'' + coordinates + '\')">Delete</button>'
                    });

                    infowindow.open(map, marker);
                }
            );
        }

        function addClickListener(map) {
            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(event.latLng, map);
            });
        }

        /* function saveMarker(coordinates) {
             console.log(coordinates);
             $.post("/admin/stores/add", coordinates)
                 .done(function () {
                     alert("Stores added successfully.");
                 })
                 .fail(function () {
                     alert("Something went wrong, adding stores failed!");
                 });
         }*/

    </script>
</th:block>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCW_AEkfqP5zRCJmRmbqRx7giXRRlVWK6o&callback=initMap"></script>
